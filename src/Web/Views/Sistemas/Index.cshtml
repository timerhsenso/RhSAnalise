@model RhSensoERP.Web.Models.Sistemas.SistemasListViewModel
@{
    ViewData["Title"] = Model.PageTitle;
    Layout = "_CrudLayout";
    ViewData["EntityName"] = "Sistema";
    ViewData["IconClass"] = "fas fa-server";
}

@*
    ============================================================================
    INDEX COM CONTROLE DE PERMISS√ïES - Sistemas
    ============================================================================
    Arquivo: Views/Sistemas/Index.cshtml
    Vers√£o: 3.0 (Com controle de bot√µes baseado em permiss√µes)
    
    Esta view:
    - Injeta as permiss√µes do usu√°rio no JavaScript via window.crudPermissions
    - Desabilita bot√µes automaticamente com base nas permiss√µes
    - Mant√©m valida√ß√£o no backend para seguran√ßa
    ============================================================================
*@

@* ============================================================================
   INJE√á√ÉO DE PERMISS√ïES NO JAVASCRIPT
   ============================================================================
   As permiss√µes s√£o injetadas ANTES de carregar o script da p√°gina,
   para que estejam dispon√≠veis durante a inicializa√ß√£o do CRUD.
   ============================================================================ *@
<script>
    // ‚≠ê Objeto global com as permiss√µes do usu√°rio
    window.crudPermissions = {
        canCreate: @Model.CanCreate.ToString().ToLower(),
        canEdit: @Model.CanEdit.ToString().ToLower(),
        canDelete: @Model.CanDelete.ToString().ToLower(),
        canView: @Model.CanView.ToString().ToLower(),
        actions: "@Model.UserPermissions" // String "IAEC"
    };

    console.log('üîê Permiss√µes carregadas:', window.crudPermissions);
</script>

@* Renderiza a tabela CRUD (container, header, toolbar, datatable) *@
@await Html.PartialAsync("_CrudTable", Model)

@* ============================================================================
   CONTE√öDO ESPEC√çFICO DO MODAL DE SISTEMAS
   Esta section √© renderizada dentro do modal pelo _CrudLayout
   ============================================================================ *@
@section ModalContent {
    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="CdSistema" class="form-label">
                <i class="fas fa-barcode me-1"></i>
                C√≥digo do Sistema <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="CdSistema" name="CdSistema"
                   maxlength="10" required placeholder="Ex: RH001">
            <small class="text-muted">C√≥digo √∫nico do sistema (at√© 10 caracteres)</small>
        </div>

        <div class="col-md-8 mb-3">
            <label for="DcSistema" class="form-label">
                <i class="fas fa-file-alt me-1"></i>
                Descri√ß√£o do Sistema <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="DcSistema" name="DcSistema"
                   maxlength="100" required placeholder="Ex: Sistema de Gest√£o de RH">
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 mb-3">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="Ativo" name="Ativo"
                       checked role="switch">
                <label class="form-check-label" for="Ativo">
                    <i class="fas fa-toggle-on me-1"></i> Sistema Ativo
                </label>
            </div>
            <small class="text-muted">Desmarque para inativar o sistema sem exclu√≠-lo</small>
        </div>
    </div>
}

@* Scripts espec√≠ficos da p√°gina *@
@section PageScripts {
    <script src="~/js/pages/sistemas.js" asp-append-version="true"></script>
}
